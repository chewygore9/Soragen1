<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SORA Wild Style Generator</title>
<style>
body {background:#0b0b0b; color:#0ff; font-family:monospace; padding:20px;}
button {background:#0ff; color:#000; border:none; padding:10px 20px; font-weight:bold; cursor:pointer;}
pre {background:#111; padding:10px; border:1px solid #0ff; white-space:pre-wrap;}
.copy {background:#333; color:#0ff; border:1px solid #0ff; margin-top:5px;}
input {background:#111; color:#0ff; border:1px solid #0ff; padding:8px; width:400px; font-family:monospace;}
</style>
</head>
<body>
<h1>üé¨ SORA Wild Style Generator</h1>
<button id="gen">Generate Two Prompts</button>
<button id="cycle">üé® Style Cycler (5 Variants)</button>
<button id="download">‚¨áÔ∏è Download JSON File</button>
<p>Project Notes (optional):</p>
<input id="notesInput" placeholder="Example: Weekend TikTok dropset, bayou noir vibe">
<div id="results"></div>

<script>
let latestPrompts = [];

async function getPrompts(){
  const res = await fetch('/generate');
  const data = await res.json();
  latestPrompts = data;
  const box = document.getElementById('results');
  box.innerHTML = '';
  data.forEach((p,i)=>{
    const j = JSON.stringify(p, null, 2);
    box.innerHTML += `
      <h2>Prompt #${i+1}</h2>
      <pre id="out${i}">${j}</pre>
      <button class="copy" onclick="copyText('out${i}')">Copy</button>
    `;
  });
}

function copyText(id){
  const el = document.getElementById(id);
  navigator.clipboard.writeText(el.innerText);
  alert('Copied to clipboard!');
}

document.getElementById('gen').addEventListener('click', getPrompts);

document.getElementById('cycle').addEventListener('click', async ()=>{
  const res = await fetch('/cycle',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({})
  });
  const data = await res.json();
  latestPrompts = data;
  const box = document.getElementById('results');
  box.innerHTML = `<h2>üé≠ Base Scene:</h2>
  <pre>${data.base_scene}</pre>
  <h3>üí¨ Dialogue:</h3>
  <pre>${data.dialogue}</pre>
  <h3>üé¨ Cameos:</h3>
  <pre>${data.cameos.join(', ')}</pre>`;

  data.variants.forEach((v,i)=>{
    const j = JSON.stringify(v, null, 2);
    box.innerHTML += `
      <h2>Variant #${i+1}</h2>
      <pre id="var${i}">${j}</pre>
      <button class="copy" onclick="copyText('var${i}')">Copy</button>
    `;
  });
});

document.getElementById('download').addEventListener('click', async ()=>{
  if(!latestPrompts || (Array.isArray(latestPrompts) && !latestPrompts.length) || (!Array.isArray(latestPrompts) && !Object.keys(latestPrompts).length)){
    alert('Generate something first!');
    return;
  }
  const notes = document.getElementById('notesInput').value;
  const res = await fetch('/download',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      filename:'sora_prompts.json',
      content: latestPrompts,
      notes: notes
    })
  });
  if(res.ok){
    const blob = await res.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'sora_prompts.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
  }
});
</script>
</body>
</html>
